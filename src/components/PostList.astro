---
import { getCollection } from "astro:content";
import { getSecret } from "astro:env/server";
import { Image } from "astro:assets";
import dayjs from "dayjs";

const blogPosts = (await getCollection("blog")).filter((post) => !post.data.draft);

blogPosts.sort((a, b) => b.slug?.localeCompare(a?.slug || "") || 0);

const { limit } = Astro.props;
---

<div class="container">
  <h2 class="font-thin text-accent text-2xl w-[300px]">Blog</h2>
  <p class="text-text-primary text-2xl lg:text-4xl max-w-xl">A collection of photos, web dev & personal improvement</p>
  <div class="grid lg:grid-cols-4 gap-6 mt-8">
    {
      blogPosts.slice(0, limit).map((post) => {
        return (
          <a
            href={`/blog/${post.slug}`}
            class={`group block not-prose border-border border-2 p-6 transition-opacity duration-300 hover:opacity-75 ${post.data?.image ? "col-span-2 row-span-2" : "row-span-1 col-span-2"}`}
          >
            <article class="relative">
              {post.data.image && (
                <div class="relative aspect-[16/9] overflow-hidden mb-4">
                  <Image
                    src={post.data.image}
                    alt={post.data.title}
                    class="w-full h-full object-cover"
                    widths={[400, 800]}
                    sizes="(max-width: 768px) 100vw, 50vw"
                  />
                </div>
              )}

              <div>
                <span class="text-accent font-thin">{dayjs(post.id.substring(0, 10)).format("MMM D, YYYY")}</span>
                <h3 class="text-lg lg:text-2xl text-text-primary font-semibold mb-4">{post.data.title}</h3>
                <div class="text-text-primary text-lg">{post.data.summary}</div>
              </div>
            </article>
          </a>
        );
      })
    }
  </div>
</div>

<style>
  /* Dark mode gradient support */
  @media (prefers-color-scheme: dark) {
    .fallback-gradient {
      background: var(--gradient-dark) !important;
    }
  }

  /* Line clamp utility for summary text */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
