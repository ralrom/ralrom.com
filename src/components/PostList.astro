---
import { getCollection } from "astro:content";
import { getSecret } from "astro:env/server";
import dayjs from "dayjs";

const blogPosts = (await getCollection("blog")).filter((post) =>
  getSecret("NODE_ENV") === "development" ? true : !post.data.draft
);
blogPosts.sort((a, b) => b.slug?.localeCompare(a?.slug || "") || 0);

const { limit } = Astro.props;
---

<div class="container max-w-3xl">
  <h2 class="font-thin text-accent text-2xl w-[300px]">Blog</h2>
  <p class="text-text-primary text-2xl lg:text-4xl max-w-xl">A collection of photos, web dev & personal improvement</p>
  <div class="grid lg:grid-cols-2 gap-12 mt-8">
    {
      blogPosts.slice(0, limit).map((post) => (
        <a href={`/blog/${post.slug}`} class="hover:opacity-75 not-prose">
          <article class="relative">
            <p class="text-accent absolute top-0 -left-2 -translate-x-full opacity-50">&bull;</p>
            <span class="text-accent font-thin">{dayjs(post.id.substring(0, 10)).format("MMM D, YYYY")}</span>
            <h3 class="text-lg lg:text-xl text-text-primary font-thin">{post.data.title}</h3>
          </article>
        </a>
      ))
    }
  </div>
</div>
